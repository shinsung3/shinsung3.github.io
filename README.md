# 이력서

## MSA
- 장바구니 단계에서는 즉시 일관성을 강제하지 않고, 주문 생성 시점에 가격·재고를 재검증하는 구조로 설계하여 사용자 경험과 시스템 복잡도의 균형을 맞춤
- 주문 시점 → 재고/가격 최종 검증 ⭕️
- 전시 영역의 잦은 정책 변경에도 장바구니 기능이 영향을 받지 않도록 API 계약 중심으로 의존성을 제한하여 변경 영향도를 최소화
- 전시(Display) 도메인에서 상품 상태 변경이 발생할 경우 장바구니(Order) 도메인이 이를 직접 조회하지 않도록 API 경계를 통해 상태 변경 요청만 전달받아 장바구니 내부 책임으로 상태를 갱신하도록 설계했습니다. 이를 통해 도메인 간 데이터 소유권을 분리하고 변경 영향도를 최소화했습니다.
- MSA 관점에서 이 검증이 왜 중요하냐면
❌ 잘못된 설계

장바구니가 전시 DB 직접 조회

장바구니가 상품 상태를 “결정”

👉 도메인 침범, 강결합
- 장바구니 도메인에서 상품 선택 상태를 관리하되,
판매 가능 여부는 전시/상품 도메인의 상태를 조건으로만 참조하도록 설계하여
도메인 간 데이터 소유권을 명확히 분리했습니다.
- 	@PostMapping("/update-cart-sel-by-prd-stat")
	@Operation(summary = "장바구니 상품 상태에 따른 업데이트", description = "장바구니 상품 상태에 따른 업데이트")


## 이벤트드리븐
- 장바구니와 전시 도메인 간 직접 의존을 줄이기 위해 상품 상태 변경을 이벤트 관점으로 해석하고, 장바구니 내부 유스케이스에서 상태 반영을 수행하는 구조를 적용했습니다


## 	@GetMapping("/calculate-amt")
	@Operation(summary = "장바구니 가격 계산 조회", description = "장바구니 가격 계산 조회") - 정합성 중심 설계의 증거
  
- why? 먼저 왜 calculate-amt를 분리할 수 없었는지를 명확히 해야 합니다.
- 당시 제약 조건 (당위성)
  - 가격/할인/프로모션 로직이 서버에 집중
  - 프론트에서 계산하기엔 정책 변경 리스크 큼
  - 장바구니 선택 상태와 금액 간 즉시 정합성 요구
- 한계 : 체크박스 토글과 같은 빈번한 UI 이벤트가 서버의 계산 로직을 매번 트리거하면서 불필요한 계산 비용과 네트워크 왕복이 발생할 수 있었다.
- 실패의 정체
  - UI 이벤트와 서버 계산 로직이 강하게 결합된 구조
  - UI 이벤트: 고빈도
  - calculate-amt: 상대적으로 고비용
  - 👉 빈도-비용 미스매치
- 장바구니 선택 상태 변경 시 금액 정합성을 우선하기 위해 서버 기준 금액 계산 API를 즉시 호출하는 구조로 구현했습니다. 다만 체크박스 토글과 같은 빈번한 UI 이벤트가 서버 계산 로직을 반복적으로 트리거할 수 있는 한계를 인지했고, 이후 debounce 처리나 구매 시점 중심의 계산으로 빈도와 비용을 분리하는 방향의 개선 가능성을 도출했습니다

- calculate-amt가 빈번하게 호출된 것은 설계 미숙이 아니라, 배송비·적립금·회원 정책이 ‘상태 의존적’이었기 때문에 서버 기준 최신 계산이 필수였던 구조적 제약 때문이었다.
- ① 배송비가 ‘최근 주문 상태’에 의존 : 자사 택배 서비스, 도서산간 / 배송 불가 지역, 가장 최근 주문 정보 기반 배송비 산출, 👉 장바구니 상태만으로 계산 ❌, 👉 주문 컨텍스트 필요
- ② 회원 정책이 다차원 분기 : 비프라임 일반, 비프라임 임직원, 프라임 회원, 프라임 여부에 따라 적립금 정책 상이, 임직원 할인 한도 제한, 👉 프론트에서 분기 처리 ❌, 👉 서버 정책 로직 필수
- ③ 적립금·쿠폰·배송비가 서로 얽힘 : 쿠폰 적용에 따라 배송비 변경, 배송비 변경에 따라 적립금 변경, 회원 등급에 따라 적립률 변경, 👉 부분 계산 불가능, 👉 전체를 한 번에 계산해야 정합성 유지
- 결론 : 정합성을 최우선으로 한 계산 구조로 인해 UI 이벤트 빈도 대비 서버 계산 호출 빈도가 높아질 수 있는 구조적 한계가 존재했다
- 5️⃣ 이 문제의 본질 (아키텍처 관점) 진짜 문제는 이거였습니다 👇 : UI 이벤트의 빈도와 서버 계산 로직의 비용이 비대칭적이었다
  
